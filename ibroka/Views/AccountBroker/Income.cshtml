@model IEnumerable<ibroka.Models.AccountBroker.Income>

@{
    ViewData["Title"] = "Income";
    Layout = "~/Views/Shared/_LayoutAccountBrokers.cshtml";
}
<style>
    .body-card {
        margin-left: 2%;
        margin-right: 2%;
        margin-top: 1%;
        margin-bottom: 2%;
    }

    .table-font {
        font-weight: 500;
    }
</style>

<div class="content">

    <div class="row">
        <div class="col-md-12">
            <div class="card card-stats card-raised">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="statistics">
                                <div class="info">
                                    <div class="icon icon-primary">
                                        <i class="now-ui-icons users_single-02"></i>

                                    </div>
                                    <h3 class="info-title"> ₦40</h3>
                                    <h6 class="stats-title">DAILY</h6>

                                </div>
                            </div>
                        </div>
                        @*<div class="col-md-3">
                                <div class="statistics">
                                    <div class="info">
                                        <div class="icon icon-success">
                                            <i class="now-ui-icons business_money-coins"></i>
                                        </div>
                                        <h3 class="info-title">
                                            45
                                        </h3>
                                        <h6 class="stats-title">Today Revenue</h6>
                                    </div>
                                </div>
                            </div>*@
                        <div class="col-md-4">
                            <div class="statistics">
                                <div class="info">
                                    <div class="icon icon-info">
                                        <i class="now-ui-icons objects_support-17"></i>
                                    </div>
                                    <h3 class="info-title"> ₦500</h3>
                                    <h6 class="stats-title">WEEKLY</h6>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="statistics">
                                <div class="info">
                                    <div class="icon icon-danger">
                                        <i class="now-ui-icons ui-2_chat-round"></i>

                                    </div>
                                    <h3 class="info-title"> ₦4,000</h3>
                                    <h6 class="stats-title">MONTHLY</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header body-card">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-3 pull-left">
                                <h4 class="card-title">Income</h4>
                            </div>


                            <div class="btn-group col-md-4 pull-right">
                                <button class="btn btn-info btn-md pull-right btn-responsive" data-toggle="modal" data-target="#exampleModalLong">

                                    <span class="btn-label">
                                        <i class="now-ui-icons travel_info"></i>
                                    </span>

                                    Add New Income

                                </button>

                                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Export Data
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="#">Copy</a>
                                    <a class="dropdown-item" href="#">CSV</a>
                                    <a class="dropdown-item" href="#">Excel</a>
                                    <a class="dropdown-item" href="#">PDF</a>
                                    <a class="dropdown-item" href="#">Print</a>

                                </div>
                            </div>
                        </div>

                        <!--Start Modal -->
                        <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLongTitle">Add New Income</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>

                                    <div class="modal-body">
                                        <form>
                                            <label class="pull-left">Income Type</label>
                                            <select class="selectpicker" data-style="btn btn-default btn-round" title="Select Income Type" data-size="7" type="text" asp-items="ViewBag.IncomeType" id="IncomeTypeId" name="IncomeTypeId" placeholder="Expense Type">
                                                <option> -- Select Income Type -- </option>
                                            </select>
                                            <br />
                                            <br />
                                            <label class="pull-left">Amount</label>
                                            <input type="number" class="form-control" id="Amount" name="Amount" />
                                            <br />

                                            <label class="pull-left">Description</label>
                                            <textarea type="text" name="Description" id="Description" class="form-control"></textarea>
                                            <br />
                                        </form>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-info" id="SubmitNewIncome">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--End Modal -->
                        <!--Start Edit Modal -->
                        <div class="modal fade" id="exampleModalLong1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLongTitle">Add Edit Income</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>

                                    <div class="modal-body">
                                        <form>
                                            <label class="pull-left">Income Type</label>
                                            <select class="selectpicker" data-style="btn btn-default btn-round" title="Select Income Type" data-size="7" type="text" asp-items="ViewBag.IncomeType" id="eIncomeTypeId" name="eIncomeTypeId" placeholder="Expense Type">
                                                <option> -- Select Income Type -- </option>
                                            </select>
                                            <br />
                                            <br />
                                            <label class="pull-left">Amount</label>
                                            <input type="number" class="form-control" id="eAmount" name="eAmount" />
                                            <input type="hidden" class="form-control" id="AddSalId" name="AddSalId" />
                                            <br />

                                            <label class="pull-left">Description</label>
                                            <textarea type="text" name="eDescription" id="eDescription" class="form-control"></textarea>
                                            <br />
                                        </form>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-info" id="SubmitEditIncome">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--End EDit Modal -->
                    </div>
                </div>

                <div class="card-body body-card">
                    <div class="col-md-12">
                        <div class="table-responsive" style="overflow: auto;">
                            <table id="datatable2" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th scope="col"><strong>S/N </strong></th>
                                        <th scope="col"><strong>Income Name</strong></th>
                                        <th scope="col"><strong>Description</strong></th>
                                        <th scope="col"><strong>Amount</strong></th>
                                        <th scope="col" class="disabled-sorting"><strong>Actions</strong></th>
                                    </tr>
                                </thead>
                                <tbody class="fontweight">

                                    @{
                                        int i = 1;

                                        @if (Model.Count() < 1)
                                        {

                                        <td></td>
                                        <td></td>
                                        <td>No Data to Display</td>
                                        <td></td>
                                        <td></td>


                                    }


                                        foreach (var item in Model)
                                        {

                                            <tr>
                                                <td class="text-center">
                                                    @i
                                                </td>


                                                <td>
                                                    @item.IncomeType.IncomeName
                                                </td>

                                                <td>
                                                    @item.Description
                                                </td>
                                                <td>
                                                    ₦@item.Amount
                                                </td>
                                                <td>
                                                    <span data-toggle="modal" data-target="#exampleModalLong1"><a href="#" class="btn btn-round btn-warning btn-icon btn-sm" title="Click to Edit" id="Editbtn" data-toggle="tooltip" data-placement="top" EditAddId="@item.Id" Selected-IncomeType="@item.IncomeTypeId" Selected-Amount="@item.Amount" Selected-Description="@item.Description"><i class="far fa-edit"></i></a></span>
                                                    <a href="#" class="btn btn-round btn-danger btn-icon btn-sm remove" title="Click to Delete" data-toggle="tooltip" data-placement="top" IncomeId="@item.Id" IncomeName="@item.IncomeType.IncomeName"><i class="fas fa-times"></i></a>

                                                </td>
                                            </tr>

                                            { i = i + 1; }
                                        }
                                    }

                                    </tbody>


                                </table>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>




@section Scripts {

    @*<link href="@Url.Content("~/css/ajaxoverlay.css")" rel="stylesheet" />*@

    <link href="@Url.Content("~/css/ajaxoverlay.css")" rel="stylesheet" />

    <script>
        $(document).ready(function () {

            $('#datatable2').DataTable({
                "pagingType": "full_numbers",
                dom: "Bfrtip",
                "lengthMenu": [
                    [10, 25, 50, -1],
                    [10, 25, 50, "All"]
                ],


                buttons: [
                    'copy',
                    'excel',
                    'csv',
                    'pdf',
                    'print',
                ],


                responsive: true,
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search records",
                }

            });

            var table = $('#datatable2').DataTable();

            // Delete a record
            table.on('click', '.remove', function (e) {
                $tr = $(this).closest('tr');

                incomeId = $(this).attr('IncomeId');
                incomeName = $(this).attr('IncomeName');


                swal({
                    title: 'Are you sure?',
                    text: "You are about to delete '" + incomeName + "'",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonClass: 'btn btn-success',
                    cancelButtonClass: 'btn btn-danger',
                    confirmButtonText: 'Yes, delete it!',
                    buttonsStyling: false
                }).then(function () {

                    $.ajax({
                        type: "POST",
                        url: "/AccountBroker/DeleteIncomeGen",
                        data: JSON.stringify(incomeId),
                        dataType: "json",
                        contentType: 'application/json; charset=utf-8',
                        headers: {
                            RequestVerificationToken:
                                $('input:hidden[name="__RequestVerificationToken"]').val()
                        },
                        success: function (r) {

                            if (r.msg == "Success") {

                                swal({
                                    title: 'Deleted!',
                                    text: 'Your file has been deleted.',
                                    type: 'success',
                                    confirmButtonClass: "btn btn-success",
                                    buttonsStyling: false
                                });


                            } else if (r.msg == "Fail") {

                                alert(r.msg);

                            } else if (r.msg == "No Data") {
                                alert(r.msg);

                            } else {
                                alert(r.msg);
                            }
                            //alert(r.msg);
                            // window.location.reload();

                        },
                        error: function () {
                            alert(r.msg);
                        }
                    });


                    table.row($tr).remove().draw();

                }).catch(swal.noop);


                e.preventDefault();
            });

            //Like record
            table.on('click', '.like', function () {
                alert('You clicked on Like button');
            });
        });
    </script>


    <script type="text/javascript">

        $(document).ready(function () {

            $("#SubmitNewIncome").click(function (event) {

                event.preventDefault();

                var NewIncome = {
                    IncomeTypeId: $("#IncomeTypeId").val(),
                    Amount: $("#Amount").val(),
                    Description: $("#Description").val(),
                };


                console.log(NewIncome);

                $.ajax({
                    type: "POST",
                    url: "/AccountBroker/PostIncome",
                    data: JSON.stringify(NewIncome),
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    headers: {
                        RequestVerificationToken:
                            $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function (r) {

                        if (r.msg == "Success") {

                            demo.showSwal('success-message');

                        } else if (r.msg == "Fail") {

                            alert(r.msg);

                        } else if (r.msg == "No Data") {
                            alert(r.msg);

                        } else {
                            alert(r.msg);
                        }
                        //alert(r.msg);
                        // window.location.reload();

                    },
                    error: function () {
                        alert(r.msg);
                    }
                });
            });
        });


        //Code for pulling the Records on the Table
        var aEditAddId;

        $(document).delegate('#Editbtn',
            'click',
            function (e) {

                aEditAddId = $(this).attr('EditAddId');
                incomeTypeId = $(this).attr('Selected-IncomeType');
                amount = $(this).attr('Selected-Amount');
                description = $(this).attr('Selected-Description');

                //  console.log(aEditAssetId);

                $('input[name=AddSalId]').val(aEditAddId);
                $('input[name=eIncomeTypeId]').val(incomeTypeId);
                $('input[name=eAmount]').val(amount);
                $('textarea[name=eDescription]').val(description);

            });

        //End of the code

        $(document).ready(function () {

            $("#SubmitEditIncome").click(function (event) {

                event.preventDefault();

                var PostIncome = {
                    AId: $("#AddSalId").val(),
                    IncomeTypeId: $("#eIncomeTypeId").val(),
                    Amount: $("#eAmount").val(),
                    Description: $("#eDescription").val(),
                };


                // console.log(Items);
                console.log(PostIncome);

                $.ajax({
                    type: "POST",
                    url: "/AccountBroker/EditIncome",
                    data: JSON.stringify(PostIncome),
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    headers: {
                        RequestVerificationToken:
                            $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function (r) {

                        if (r.msg == "Success") {

                            demo.showSwal('success-message');

                        } else if (r.msg == "Fail") {

                            alert(r.msg);

                        } else if (r.msg == "No Data") {
                            alert(r.msg);

                        } else {
                            alert(r.msg);
                        }
                        //alert(r.msg);
                        // window.location.reload();

                    },
                    error: function () {
                        alert(r.msg);
                    }
                });
            });



        });

    </script>

}


